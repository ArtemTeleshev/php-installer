#!/usr/bin/env bash

validate_version ${PHP_VERSION}

if [ ! -d $DIR_SRC ] ; then
  mkdir -p $DIR_SRC || exit 1
fi

cd $DIR_SRC || exit 2
if [ ! -f $DIR_SRC/$PHP_ARCHIVE_NAME ] ; then
  wget $DOWNLOAD_URL || exit 3
fi

if [ ! -d $PHP_DIR ] ; then
  tar -xvf $PHP_ARCHIVE_NAME || exit 4
fi

cd $PHP_DIR || exit 5

./configure --prefix=$PREFIX \
            --exec-prefix=$EPREFIX \
            --with-config-file-scan-dir=$EXTENSION_INI_DIR \
            --disable-ipv6 \
            --enable-ftp \
            --enable-fpm \
            --enable-zip \
            --enable-intl \
            --enable-soap \
            --enable-exif \
            --enable-shmop \
            --enable-libxml \
            --enable-sockets \
            --enable-calendar \
            --enable-mbstring \
            --enable-gd-jis-conv \
            --enable-gd-native-ttf \
            --enable-maintainer-zts \
            --with-gd \
            --with-xsl \
            --with-curl \
            --with-zlib \
            --with-mhash \
            --with-png-dir \
            --with-vpx-dir \
            --with-openssl \
            --with-readline \
            --with-jpeg-dir \
            --with-freetype-dir \
            --with-regex=php \
            --with-layout=GNU \
            --with-zend-vm=CALL \
            --with-mysql=mysqlnd \
            --with-mysqli=mysqlnd \
            --with-pdo-mysql=mysqlnd \
            --enable-maintainer-zts \
          || exit 6
#            --with-xmp-dir \

# install
make install || exit 7

